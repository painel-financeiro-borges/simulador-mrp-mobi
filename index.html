<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador MRP Mobi ‚Äì Rede Visual</title>

  <!-- VIS NETWORK -->
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    #controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
      justify-content: center;
    }

    input, button {
      padding: 8px;
      border-radius: 6px;
      border: none;
    }

    button {
      cursor: pointer;
      background: #2563eb;
      color: #fff;
    }

    #network {
      width: 100%;
      height: 500px;
      border: 1px solid #334155;
      background: #020617;
      border-radius: 10px;
    }

    #resultado {
      margin-top: 20px;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>

<body>

<h1>Simulador Visual ‚Äì MRP Mobi</h1>

<div id="controls">
  <input type="number" id="indicados" placeholder="Indicados por pessoa" value="2">
  <input type="number" id="corridas" placeholder="Corridas / m√™s" value="10">
  <button onclick="gerarRede()">Simular Rede</button>
</div>

<div id="network"></div>

<div id="resultado"></div>

<script>
  const VALOR_CORRIDA = 10;
  const COMISSAO = 0.02;

  let nodes = new vis.DataSet();
  let edges = new vis.DataSet();

  let nodeId = 1;

  function gerarRede() {
    nodes.clear();
    edges.clear();
    nodeId = 1;

    const indicados = parseInt(document.getElementById("indicados").value);
    const corridas = parseInt(document.getElementById("corridas").value);

    let total = 0;

    // N√ì PRINCIPAL
    nodes.add({
      id: nodeId,
      label: "VOC√ä",
      level: 0
    });

    criarGeracao(nodeId, indicados, corridas, 1);

    function criarGeracao(paiId, qtd, corridasMes, nivel) {
      for (let i = 0; i < qtd; i++) {
        nodeId++;

        nodes.add({
          id: nodeId,
          label: `G${nivel}\n${corridasMes} corridas`,
          level: nivel
        });

        edges.add({
          from: paiId,
          to: nodeId
        });

        const ganho = corridasMes * VALOR_CORRIDA * COMISSAO;
        total += ganho;

        // GERA√á√ÉO AUTOM√ÅTICA (repete o mesmo padr√£o)
        if (nivel < 5) { // pode aumentar sem medo
          criarGeracao(nodeId, qtd, corridasMes, nivel + 1);
        }
      }
    }

    const container = document.getElementById("network");
    const data = { nodes, edges };

    const options = {
      layout: {
        hierarchical: {
          direction: "UD",
          sortMethod: "directed",
          nodeSpacing: 150,
          levelSeparation: 120
        }
      },
      nodes: {
        shape: "box",
        color: {
          background: "#1e3a8a",
          border: "#60a5fa"
        },
        font: {
          color: "#e5e7eb"
        }
      },
      edges: {
        color: "#64748b"
      },
      physics: false
    };

    new vis.Network(container, data, options);

    document.getElementById("resultado").innerHTML =
      `üí∞ Total mensal estimado: <strong>${total.toLocaleString("pt-BR", {
        style: "currency",
        currency: "BRL"
      })}</strong>`;
  }
</script>

</body>
</html>      font-weight:700;
    }
    .breakdown{
      margin-top:12px;
      text-align:left;
      font-size:14px;
      color:#0b1720;
    }
    .muted-text{color:var(--muted); font-size:13px}
    .note{font-size:13px;color:var(--muted); margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulador MRP Mobi ‚Äì Fluxograma</h1>

    <div class="grid">
      <div class="card inputs" aria-labelledby="form-title">
        <h2 id="form-title" class="small">Entradas</h2>

        <label for="g1">Indicados diretos (1¬™ gera√ß√£o)</label>
        <input type="number" id="g1" min="0" step="1" value="100" aria-label="Indicados diretos">

        <label for="g2porPessoa">Indicados por pessoa (2¬™ gera√ß√£o)</label>
        <input type="number" id="g2porPessoa" min="0" step="0.01" value="1" aria-label="Indicados por pessoa">

        <label for="corridas">Corridas por pessoa / m√™s</label>
        <input type="number" id="corridas" min="0" step="0.01" value="1" aria-label="Corridas por pessoa por m√™s">

        <label for="valorCorrida">Valor m√©dio da corrida (R$)</label>
        <input type="number" id="valorCorrida" min="0" step="0.01" value="10" aria-label="Valor m√©dio da corrida">

        <label for="comissao">Comiss√£o (%)</label>
        <input type="number" id="comissao" min="0" step="0.01" value="2" aria-label="Comiss√£o percentual">

        <div class="row">
          <button id="btnCalcular" class="btn" type="button">Calcular</button>
          <button id="btnReset" class="btn" style="background:#6b7280">Resetar</button>
        </div>

        <p class="note">Altera√ß√µes tamb√©m recalculem automaticamente. Use os bot√µes se preferir a√ß√£o expl√≠cita.</p>
      </div>

      <div class="card">
        <h2 class="small">Visualiza√ß√£o do Fluxograma</h2>

        <div class="fluxograma" role="group" aria-label="Fluxograma de gera√ß√µes">
          <div class="box" id="boxVoc√™">
            <h3>Voc√™</h3>
            <p class="small">In√≠cio da rede</p>
          </div>

          <div class="arrow" aria-hidden="true">‚û°Ô∏è</div>

          <div class="box" id="boxG1">
            <h3>1¬™ Gera√ß√£o</h3>
            <p id="g1Texto" class="small">-</p>
            <p id="ganhoG1" style="font-weight:600">-</p>
          </div>

          <div class="arrow" aria-hidden="true">‚û°Ô∏è</div>

          <div class="box" id="boxG2">
            <h3>2¬™ Gera√ß√£o</h3>
            <p id="g2Texto" class="small">-</p>
            <p id="ganhoG2" style="font-weight:600">-</p>
          </div>
        </div>

        <div class="breakdown" id="breakdown">
          <!-- breakdown din√°mico -->
        </div>

        <div class="resultado" id="resultadoFinal" role="status" aria-live="polite">
          Total mensal estimado: R$ 0,00
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const el = id => document.getElementById(id);
      const fmtBRL = new Intl.NumberFormat('pt-BR', {style:'currency', currency:'BRL'});
      const fmtNum = new Intl.NumberFormat('pt-BR', {maximumFractionDigits:2, minimumFractionDigits:0});

      const inputs = ['g1','g2porPessoa','corridas','valorCorrida','comissao'].map(id => el(id));
      const btnCalc = el('btnCalcular');
      const btnReset = el('btnReset');

      function parsePositive(input){
        const n = Number(input);
        if (!isFinite(n) || n < 0) return 0;
        return n;
      }

      function calcular(){
        const g1 = Math.floor(parsePositive(el('g1').value));
        const g2porPessoa = parsePositive(el('g2porPessoa').value);
        const corridas = parsePositive(el('corridas').value);
        const valor = parsePositive(el('valorCorrida').value);
        const comissao = parsePositive(el('comissao').value) / 100;

        // c√°lculo
        const g2 = g1 * g2porPessoa;
        const ganhoPorCorrida = valor * comissao;

        const ganhoG1 = g1 * corridas * ganhoPorCorrida;
        const ganhoG2 = g2 * corridas * ganhoPorCorrida;
        const total = ganhoG1 + ganhoG2;

        // atualizar UI
        el('g1Texto').innerText = `${g1.toLocaleString('pt-BR')} pessoas √ó ${corridas.toLocaleString('pt-BR')} corridas`;
        el('ganhoG1').innerText = `Ganho: ${fmtBRL.format(ganhoG1)}`;

        el('g2Texto').innerText = `${g2.toLocaleString('pt-BR')} pessoas √ó ${corridas.toLocaleString('pt-BR')} corridas`;
        el('ganhoG2').innerText = `Ganho: ${fmtBRL.format(ganhoG2)}`;

        el('resultadoFinal').innerText = `Total mensal estimado: ${fmtBRL.format(total)}`;

        // breakdown detalhado
        el('breakdown').innerHTML = `
          <div class="muted-text">Detalhamento</div>
          <div>Comiss√£o aplicada por corrida: ${ (comissao*100).toLocaleString('pt-BR', {maximumFractionDigits:2}) }%</div>
          <div>Valor por corrida (comiss√£o): ${fmtBRL.format(ganhoPorCorrida)}</div>
          <div style="margin-top:8px">1¬™ gera√ß√£o: ${g1.toLocaleString('pt-BR')} pessoas ‚Äî Ganho ${fmtBRL.format(ganhoG1)}</div>
          <div>2¬™ gera√ß√£o: ${g2.toLocaleString('pt-BR')} pessoas ‚Äî Ganho ${fmtBRL.format(ganhoG2)}</div>
        `;
      }

      // recalcula automaticamente ao alterar qualquer campo (com debounce)
      let timer;
      inputs.forEach(i => {
        i.addEventListener('input', () => {
          clearTimeout(timer);
          timer = setTimeout(calcular, 250);
        });
      });

      btnCalc.addEventListener('click', calcular);
      btnReset.addEventListener('click', () => {
        el('g1').value = 100;
        el('g2porPessoa').value = 1;
        el('corridas').value = 1;
        el('valorCorrida').value = 10;
        el('comissao').value = 2;
        calcular();
      });

      // inicial
      calcular();
    })();
  </script>
</body>
        </html>
